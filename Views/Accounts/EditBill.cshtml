@model Bill
@{
    Layout = "~/Views/Shared/_Accounts_Layout.cshtml";
}

<style>
    .edit-container {
        max-width: 950px;
        margin: 30px auto;
    }

    .edit-card {
        background: #ffffff;
        border-radius: 20px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.08);
        border: none;
        overflow: hidden;
    }

    .edit-header {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); /* Warning Orange for Edit */
        padding: 30px;
        color: white;
    }

    .field-label {
        font-weight: 700;
        color: #334155;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
    }

    .input-box {
        border-radius: 12px;
        padding: 14px 18px;
        border: 2px solid #e2e8f0;
        font-weight: 500;
        transition: 0.3s;
        background: #fdfdfd;
    }

        .input-box:focus {
            border-color: #f59e0b;
            background: #fff;
            box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
            outline: none;
        }

    .input-readonly {
        background-color: #f1f5f9 !important;
        color: #64748b;
        cursor: not-allowed;
        border-style: dashed;
    }

    /* Calculation Highlight Side */
    .calc-sidebar {
        background: #fffbeb;
        border-left: 1px solid #fde68a;
        padding: 30px;
    }

    .calc-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #fef3c7;
    }

    .final-amount-box {
        background: #f59e0b;
        color: white;
        padding: 20px;
        border-radius: 15px;
        margin-top: 20px;
        text-align: center;
    }

    .btn-update {
        background: #1d976c;
        color: white;
        border: none;
        padding: 15px;
        border-radius: 12px;
        font-weight: 700;
        width: 100%;
        transition: 0.3s;
    }

        .btn-update:hover {
            background: #167e5a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(29, 151, 108, 0.3);
        }

    .btn-cancel {
        background: #f1f5f9;
        color: #64748b;
        border: none;
        padding: 15px;
        border-radius: 12px;
        font-weight: 600;
        width: 100%;
        text-align: center;
        text-decoration: none;
        display: block;
        margin-top: 10px;
        transition: 0.2s;
    }

        .btn-cancel:hover {
            background: #e2e8f0;
            color: #1e293b;
        }
</style>

<div class="edit-container">
    <div class="edit-card">
        <div class="edit-header">
            <div class="d-flex align-items-center">
                <div class="bg-white text-warning rounded-circle p-3 me-3">
                    <i class="fa-solid fa-pen-nib fs-4"></i>
                </div>
                <div>
                    <h3 class="mb-0 fw-bold">Modify Invoice #@Model.BillId</h3>
                    <p class="mb-0 opacity-75">Update tax, discount or due dates for this bill</p>
                </div>
            </div>
        </div>

        <form asp-action="EditBill" method="post">
            @Html.HiddenFor(m => m.BillId)
            @Html.HiddenFor(m => m.OrderId)

            <div class="row g-0">
                <div class="col-lg-7 p-4 p-md-5">
                    <div class="row">
                        <div class="col-12 mb-4">
                            <label class="field-label"><i class="fa-solid fa-vault me-2"></i> Original Plan Amount</label>
                            <input id="planAmount" asp-for="PlanAmount" class="form-control input-box input-readonly w-100" readonly />
                        </div>

                        <div class="col-md-6 mb-4">
                            <label class="field-label text-danger"><i class="fa-solid fa-scissors me-2"></i> Discount</label>
                            <input id="discount" asp-for="DiscountAmount" class="form-control input-box w-100" />
                        </div>

                        <div class="col-md-6 mb-4">
                            <label class="field-label text-primary"><i class="fa-solid fa-percent me-2"></i> Tax Rate (%)</label>
                            <input id="taxPercent" asp-for="TaxPercentage" class="form-control input-box w-100" />
                        </div>

                        <div class="col-12 mb-4">
                            <label class="field-label"><i class="fa-solid fa-calendar-check me-2"></i> New Due Date</label>
                            <input asp-for="DueDate" type="date" class="form-control input-box w-100" />
                        </div>
                    </div>
                </div>

                <div class="col-lg-5 calc-sidebar">
                    <h5 class="fw-bold mb-4">Adjustment Preview</h5>

                    <div class="calc-row">
                        <span class="text-muted">Sub-Total:</span>
                        <span class="fw-bold">Rs. <span id="lblSubTotal">@Model.PlanAmount</span></span>
                    </div>

                    <div class="calc-row">
                        <span class="text-muted text-danger">Less Discount:</span>
                        <span class="fw-bold text-danger">- Rs. <span id="lblDiscount">0.00</span></span>
                    </div>

                    <div class="calc-row">
                        <span class="text-muted">Calculated Tax:</span>
                        <span class="fw-bold">Rs. <span id="lblTax">0.00</span></span>
                    </div>

                    <div class="final-amount-box">
                        <small class="text-uppercase fw-bold opacity-75 d-block mb-1">Total Payable</small>
                        <h2 class="mb-0 fw-bold">Rs. <span id="lblTotal">0.00</span></h2>
                    </div>

                    <input type="hidden" id="taxAmount" asp-for="TaxAmount" />
                    <input type="hidden" id="totalAmount" asp-for="Amount" />

                    <div class="mt-4">
                        <button type="submit" class="btn-update">
                            <i class="fa-solid fa-rotate me-2"></i> Update Invoice
                        </button>
                        <a asp-action="BillView" class="btn-cancel">
                            <i class="fa-solid fa-xmark me-2"></i> Discard Changes
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    const planIn = document.getElementById("planAmount");
    const discIn = document.getElementById("discount");
    const taxPerIn = document.getElementById("taxPercent");
    const taxAmtIn = document.getElementById("taxAmount");
    const totalAmtIn = document.getElementById("totalAmount");

    const lblSub = document.getElementById("lblSubTotal");
    const lblDisc = document.getElementById("lblDiscount");
    const lblTax = document.getElementById("lblTax");
    const lblTotal = document.getElementById("lblTotal");

    function updateCalculations() {
        const plan = parseFloat(planIn.value) || 0;
        const discount = parseFloat(discIn.value) || 0;
        const taxPercent = parseFloat(taxPerIn.value) || 0;

        const taxable = plan - discount;
        const tax = (taxable * taxPercent) / 100;
        const total = taxable + tax;

        // Hidden Inputs update
        taxAmtIn.value = tax.toFixed(2);
        totalAmtIn.value = total.toFixed(2);

        // Visual labels update
        lblSub.innerText = plan.toLocaleString('en-US', { minimumFractionDigits: 2 });
        lblDisc.innerText = discount.toLocaleString('en-US', { minimumFractionDigits: 2 });
        lblTax.innerText = tax.toLocaleString('en-US', { minimumFractionDigits: 2 });
        lblTotal.innerText = total.toLocaleString('en-US', { minimumFractionDigits: 2 });
    }

    discIn.addEventListener("input", updateCalculations);
    taxPerIn.addEventListener("input", updateCalculations);

    // Run on load to show current values
    window.onload = updateCalculations;
</script>